<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>„Å≤„Åç„Åñ„Çì„Åã„ÅÇ„Å©‚ë° „Åè„Çä„Åï„Åå„Çä„ÅÆ„ÅÇ„Çã „Å≤„Åç„Åñ„Çì</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap"
    rel="stylesheet"
  />

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
      background-color: #f0f9ff;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      /* overflow:hidden „ÅØÁµ∂ÂØæ„Å´ÂÖ•„Çå„Å™„ÅÑ */
    }

    @keyframes shake {
      0%,100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }
    .shake {
      animation: shake 0.3s ease-in-out;
    }

    .dots-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 4px;
      width: fit-content;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    /* ---------- Utility ---------- */

    const GameMode = {
      SEQUENTIAL_ASC: 'SEQUENTIAL_ASC',
      SEQUENTIAL_DESC: 'SEQUENTIAL_DESC',
      RANDOM_10: 'RANDOM_10',
      RANDOM_20: 'RANDOM_20',
    };

    const generateSubtractionPool = () => {
      const pool = [];
      for (let a = 11; a <= 18; a++) {
        for (let b = 1; b <= 9; b++) {
          if (a % 10 < b && a - b >= 0 && a - b < 10) {
            pool.push({ val1: a, val2: b, answer: a - b });
          }
        }
      }
      return pool;
    };

    const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);

    /* ---------- Pages ---------- */

    const Home = ({ onStart, onHistory }) => (
      <div className="min-h-[100svh] flex items-center justify-center p-4">
        <div className="bg-white w-full max-w-sm p-6 rounded-[36px] shadow-xl border-4 border-sky-200">
          <h1 className="text-3xl font-extrabold text-sky-600 text-center mb-1">
            „Å≤„Åç„Åñ„Çì„Åã„ÅÇ„Å©‚ë°
          </h1>
          <p className="text-center font-bold text-orange-400 mb-6">
            „Åè„Çä„Åï„Åå„Çä„ÅÆ„ÅÇ„Çã „Å≤„Åç„Åñ„Çì
          </p>

          <div className="space-y-3">
            <button
              onClick={() => onStart(GameMode.SEQUENTIAL_ASC)}
              className="w-full bg-blue-500 text-white font-bold py-3 rounded-2xl"
            >
              „Åò„ÇÖ„Çì„Å∞„Çì
            </button>
            <button
              onClick={() => onStart(GameMode.SEQUENTIAL_DESC)}
              className="w-full bg-purple-500 text-white font-bold py-3 rounded-2xl"
            >
              „Åé„ÇÉ„Åè„Åò„ÇÖ„Çì
            </button>
            <button
              onClick={() => onStart(GameMode.RANDOM_10)}
              className="w-full bg-orange-400 text-white font-bold py-3 rounded-2xl"
            >
              „É©„É≥„ÉÄ„É†10Âïè
            </button>
            <button
              onClick={() => onStart(GameMode.RANDOM_20)}
              className="w-full bg-green-500 text-white font-bold py-3 rounded-2xl"
            >
              „É©„É≥„ÉÄ„É†20Âïè
            </button>
          </div>

          <button
            onClick={onHistory}
            className="mt-6 w-full bg-gray-100 py-3 rounded-xl font-bold"
          >
            üìã „Åç„Çç„Åè„ÇíË¶ã„Çã
          </button>
        </div>
      </div>
    );

    const History = ({ history, onBack }) => (
      <div className="min-h-[100svh] flex flex-col bg-sky-50">
        <header className="p-4 bg-white shadow flex items-center justify-between">
          <button onClick={onBack} className="font-bold text-sky-600">
            ‚Üê „ÇÇ„Å©„Çã
          </button>
          <span className="font-black">„Åç„Çç„Åè</span>
          <span className="w-10" />
        </header>

        <main className="flex-1 overflow-y-auto p-4 pb-[env(safe-area-inset-bottom)]">
          {history.length === 0 ? (
            <div className="h-full flex items-center justify-center text-gray-400 font-bold">
              „Åæ„Å† „Åç„Çç„Åè„Åå „ÅÇ„Çä„Åæ„Åõ„Çì
            </div>
          ) : (
            <div className="space-y-2 max-w-md mx-auto">
              {history.map((h, i) => (
                <div
                  key={i}
                  className="bg-white rounded-xl p-3 shadow border text-sm font-bold"
                >
                  <div className="flex justify-between">
                    <span>{h.mode}</span>
                    <span>{Math.round(((h.total - h.wrong) / h.total) * 100)}%</span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </main>
      </div>
    );

    const Game = ({ problems, onFinish, onBack }) => {
      const [i, setI] = useState(0);
      const start = useRef(Date.now());
      const p = problems[i];

      const answer = (n) => {
        if (n === p.answer) {
          if (i + 1 < problems.length) setI(i + 1);
          else onFinish(Date.now() - start.current);
        }
      };

      return (
        <div className="min-h-[100svh] flex flex-col bg-sky-50">
          <header className="p-3 bg-white shadow flex justify-between">
            <button onClick={onBack}>‚Üê</button>
            <span>{i + 1}/{problems.length}</span>
          </header>

          <main className="flex-1 flex items-center justify-center p-4">
            <div className="bg-white rounded-[32px] shadow-xl p-6 text-6xl font-black">
              {p.val1} ‚àí {p.val2}
            </div>
          </main>

          <footer className="bg-white p-4 pb-[env(safe-area-inset-bottom)]">
            <div className="grid grid-cols-5 gap-2 max-w-sm mx-auto">
              {[1,2,3,4,5,6,7,8,9,0].map(n => (
                <button
                  key={n}
                  onClick={() => answer(n)}
                  className="aspect-square bg-orange-50 rounded-xl font-bold text-xl"
                >
                  {n}
                </button>
              ))}
            </div>
          </footer>
        </div>
      );
    };

    /* ---------- App ---------- */

    const App = () => {
      const [screen, setScreen] = useState('HOME');
      const [problems, setProblems] = useState([]);
      const [history, setHistory] = useState([]);

      const startGame = (mode) => {
        let pool = generateSubtractionPool();
        if (mode === GameMode.RANDOM_10) pool = shuffle(pool).slice(0, 10);
        if (mode === GameMode.RANDOM_20) pool = shuffle(pool).slice(0, 20);
        setProblems(pool);
        setScreen('GAME');
      };

      const finishGame = (time) => {
        setHistory([{ mode: '„Éó„É¨„Ç§', total: problems.length, wrong: 0 }, ...history]);
        setScreen('HOME');
      };

      return (
        <div className="min-h-[100svh] w-screen">
          {screen === 'HOME' && (
            <Home
              onStart={startGame}
              onHistory={() => setScreen('HISTORY')}
            />
          )}
          {screen === 'GAME' && (
            <Game
              problems={problems}
              onFinish={finishGame}
              onBack={() => setScreen('HOME')}
            />
          )}
          {screen === 'HISTORY' && (
            <History history={history} onBack={() => setScreen('HOME')} />
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
